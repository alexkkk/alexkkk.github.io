---
title: golang匿名成员
date: 2016-10-13 19:51:07
tags: golang
---

## 前言
之前在将struct通过json.Marsha转换成json的时候，如果遇到嵌套的struct，总是要多增加一个层级，还要取个名字。
比较麻烦，今天看到golang的匿名成员，想试下匿名成员是否还要加个名字。

## 代码

```go
package main

import (
	"encoding/json"
	"fmt"
)

type A struct {
	Foo string `json:"foo"`
	Bar string `json:"bar"`
}

type B struct {
	Code int 		`json:"code"`
	Message string	`json:"message"`
	*A
}

type C struct {
	Code int
	Message string
	A
}

func main() {
	a := A{
		Foo : "foo",
		Bar : "bar",
	}
	b := B { 200, "OK", &a}

	c := C { 200, "OK", a}

	astr, _ := json.Marshal(a)
	fmt.Println(string(astr))
	fmt.Println()

	bstr, _ := json.Marshal(b)
	fmt.Println(string(bstr))
	fmt.Println()

	cstr, _ := json.Marshal(c)
	fmt.Println(string(cstr))
	fmt.Println()

	str := `{"code":500,"message":"internal error","foo":"xxxfoo","bar":"xxxbar"}`
	var bb B
	json.Unmarshal([]byte(str), &bb)
	fmt.Println("code:", bb.Code)
	fmt.Println("message:", bb.Message)
	fmt.Println("foo:", bb.Foo)
	fmt.Println("bar:", bb.Bar)
	fmt.Println()

	str = `{"code":400,"message":"client internal error","foo":"yyyfoo","bar":"yyybar"}`
	var bbb C
	json.Unmarshal([]byte(str), &bbb)
	fmt.Println("code:", bbb.Code)
	fmt.Println("message:", bbb.Message)
	fmt.Println("foo:", bbb.Foo)
	fmt.Println("bar:", bbb.Bar)
	fmt.Println()
}
```

## 测试结果
```bash
{"foo":"foo","bar":"bar"}

{"code":200,"message":"OK","foo":"foo","bar":"bar"}

{"Code":200,"Message":"OK","foo":"foo","bar":"bar"}

code: 500
message: internal error
foo: xxxfoo
bar: xxxbar

code: 400
message: client internal error
foo: yyyfoo
bar: yyybar
```

